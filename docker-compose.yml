version: '3.8' # Versión de Docker Compose

services:
  # 1. La Base de Datos PostgreSQL
  db-postgres:
    image: postgres:15-alpine # Usamos una imagen ligera de Postgres
    container_name: db_postgres
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: tu_contraseña_de_postgres # ¡USA TU CONTRASEÑA REAL!
      POSTGRES_DB: proyecto_sd # Docker creará la BD por nosotros
    ports:
      - "5432:5432" # Expone el puerto de la BD a tu máquina local

  # 2. El Servicio REST (Java)
  servicio-rest:
    build: ./servicio-core-negocio # Le decimos que construya desde esta carpeta
    container_name: servicio_rest
    ports:
      - "8080:8080" # Expone el puerto 8080
    depends_on:
      - db-postgres # No arranques hasta que la BD esté lista
    environment:
      # Le decimos al servicio CÓMO encontrar la BD (usamos el nombre del servicio)
      SPRING_DATASOURCE_URL: jdbc:postgresql://db-postgres:5432/proyecto_sd
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: tu_contraseña_de_postgres # ¡USA TU CONTRASEÑA REAL!
      SPRING_JPA_HIBERNATE_DDL_AUTO: update

  # 3. El Servicio SOAP (Java)
  servicio-soap:
    build: ./servicio-facturacion # Le decimos que construya desde esta carpeta
    container_name: servicio_soap
    ports:
      - "8081:8081" # Expone el puerto 8081

  # 4. El Servicio de Tracking (Node.js)
  servicio-tracking:
    build: ./servicio-tracking # Le decimos que construya desde esta carpeta
    container_name: servicio_tracking
    ports:
      - "3000:3000" # Expone el puerto 3000